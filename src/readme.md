## Part 1. Готовый докер

#### Возьмем официальный докер-образ `nginx` и выкачаем его
```
docker pull nginx
```
![](images/Pasted%20image%2020250222230002.png)\
Успешная загрузка образа.
#### Проверь наличие докер-образа
```
docker images
```
![](images/Pasted%20image%2020250222231053.png)\
Результат просмотра всех докеров-образов.
#### Запустим докер-образ
```
docker run -d [image_id|repository].
```
![](images/Pasted%20image%2020250223134804.png)\
Запуск докер-образа в фоновом режиме.
#### Проверим, что образ запустился
```
docker ps
```
![](images/Pasted%20image%2020250223134839.png)\
Проверка запуска образа.
#### Посмотрим информацию о контейнере
```
docker inspect 3d4349fc0cbc
```
Далее определим необходимые данные о контейнере.
#### Определим размер контейнера
```
docker inspect --size 3d4349fc0cbc | grep -i size
```
![](images/Pasted%20image%2020250223140321.png)\
SizeRootFs - общий размер всех файлов в контейнере, байты.
#### Определим список портов контейнера
```
docker inspect --size 3d4349fc0cbc | grep -i ports -A 1
```
![](images/Pasted%20image%2020250223141302.png)\
Порты контейнера. Данный контейнер слушает 80 порт.
#### Определим ip контейнера
```
docker inspect --size 3d4349fc0cbc | grep -i ipaddress
```
![](images/Pasted%20image%2020250223141407.png)\
Демонстрация ip адреса контейнера
#### Остановим докер контейнер
```
docker stop 3d4349fc0cbc
```
![](images/Pasted%20image%2020250223141646.png)\
Остановка контейнера
#### Проверим, что контейнер остановился
```
docker ps -a
```
![](images/Pasted%20image%2020250223141712.png)
Флаг -a показывает все контейнеры
#### Запустим докер с портами 80 и 443 в контейнере
```
docker run -d -p 80:80 -p 443:443 nginx
```
![](images/Pasted%20image%2020250223144348.png)\
Запуск контейнера с необходимыми портами.\
![](images/Pasted%20image%2020250223143619.png)\
Контейнер успешно запустился.
#### Проверим стартовую страницу nginx
![](images/Pasted%20image%2020250223144004.png)\
Стартовая страница по адресу localhost:80 доступна.
#### Перезапустим докер контейнер
```
docker restart 33364с0e4416
```
![](images/Pasted%20image%2020250223143642.png)\
Контейнер перезапущен.
#### Проверим, что контейнер запустился
```
sudo docker ps
```
![](images/Pasted%20image%2020250223143713.png)\
Контейнер работает.
## Part 2. Операции с контейнером
#### Прочитаем конфигурационный файл `nginx.conf`
```
sudo docket exec nginx_part2 cat /etc/nginx/nginx.conf
```
![](images/Pasted%20image%2020250223163034.png)\
Содержание файла `nginx.conf`.
#### Создадим свой файл `nginx`
![](images/Pasted%20image%2020250223170810.png)\
Настроенный конфигурационный файл `nginx.conf`.
#### Скопируем созданный файл `nginx.conf` внутрь докер-образа
```
docker cp nginx.conf nginx_part2:/etc/nginx/
```
![](images/Pasted%20image%2020250223170122.png)\
Скопировал ранее написанный файл в докер-образ.
#### Перезапустим `nginx` внутри докер-образа
```
docker exec nginx_part2 nginx -t
docker exec nginx_part2 nginx -s reload
```
![](images/Pasted%20image%2020250223170753.png)\
Проверка работоспособности нового конфигурационного файла и перезапуск `nginx`.
#### Проверим, что страничка со статусом сервера nginx работает
![](images/Pasted%20image%2020250223171752.png)\
Демонстрация страницы по адресу localhost:80/status.
#### Экспортируем контейнер в файл
```
docker export -o container.tar nginx_part2
```  
![](images/Pasted%20image%2020250223172321.png)\
Архив был успешно сформирован.
#### Остановим контейнер.
![](images/Pasted%20image%2020250223172400.png)\
Остановка контейнера.
#### Удалим образ `nginx`
```
docker rmi -f nginx
```
![](images/Pasted%20image%2020250223172455.png)\
Удалил образ.
#### Удалим остановленный контейнер.
```
docker rn nginx_part2
```
![](images/Pasted%20image%2020250223172527.png)\
Удалил контейнер.\
![](images/Pasted%20image%2020250223172546.png)\
Проверил что контейнер удален.
#### Импортируем контейнер обратно
```
sudo docker import -c 'CMD ["nginx", "-g", "daemon off;"]' container.tar new_nginx:new
```
![](images/Pasted%20image%2020250223173714.png)\
Успешный импорт контейнера. \
В данной команде была добавлена инструкция для запуска nginx и работы в foreground-режиме.
#### Запустим импортированный контейнер.
![](images/Pasted%20image%2020250223173845.png)\
Успешный запуск контейнера.
#### Проверим страничку со статусом сервера `nginx`
![](images/Pasted%20image%2020250223173910.png)\
Демонстрация работы страницы по адресу localhost:80/status.

## Part 3. Мини веб-сервер
#### Напишем мини-сервер на C, который будет возвращать простейшую страничку с надписью Hello World!
![](images/Pasted%20image%2020250224003745.png)\
Код программы для мини-сервера. \
После компиляции бинарный файл может быть запущен напрямую без использования spawn-fcgi or cgi-fcgi. \
![](images/Pasted%20image%2020250223233107.png)\
 Компиляция и запуск файла в фоном режиме. 
#### Напишем свой `nginx.conf`, который будет проксировать все запросы с 81 порта на 127.0.0.1:8080.
![](images/Pasted%20image%2020250224003718.png)\
Новые изменения в конфигурационном файле.
#### Проверим страничку localhost:81
![](images/Pasted%20image%2020250224003955.png)\
Успешный результат выполнения 3 части.

## Part 4. Свой докер
#### Напишем свой докер-образ
Требования:
1) собирает исходники мини-сервера на FastCgi из Части 3;
2) запускает его на 8080 порту;
3) копирует внутрь образа написанный ./nginx/nginx.conf;
4) запускает nginx.


![](images/Pasted%20image%2020250224213948.png)\
Код написанного докер-образа.\
![](images/Pasted%20image%2020250224215141.png)\
Скрипт для запуска мини-сервера и nginx.
#### Соберем написанный докер-образ 
```
docker build -t nginx_part5:latest .
```
![](images/Pasted%20image%2020250224200014.png)\
Билд докер-образа и проверка корректности сборки.
#### Запустим собранный докер-образ с маппингом 81 порта на 80 на локальной машине и маппингом папки `./nginx`
```
docker run --name hello_world -d -p 80:81 -v ./nginx/nginx.conf:/etc/nginx/nginx.conf nginx_part5:latest
```
![](images/Pasted%20image%2020250224200524.png)\
Запуск нового контейнера
#### Проверим работу мини-сервера.
![](images/Pasted%20image%2020250224212349.png)\
Демонстрация доступа страницы по пути `localhost:80`.

#### Допишем в `nginx.conf` статус сервера `nginx`.
![](images/Pasted%20image%2020250224212448.png)\
Новые изменения в конфигурационном файле.
#### Снова проверим работу мини-сервера.
![](images/Pasted%20image%2020250224213236.png)\
Теперь по `localhost:80/status` отдается страничка со статусом nginx.
## Part 5. Dockle

#### Просканируем образ из предыдущего задания и исправим `Dockerfile`
```
dockle nginx_part5:latest
```
![](images/Pasted%20image%2020250224220437.png)\
Команда `dockle` вывела следующее. \
![](images/Pasted%20image%2020250225123953.png)\
Исправленный Dockerfile.
#### Снова просканируем образ на наличие ошибок и предупреждений
![](images/Pasted%20image%2020250224223959.png)\
Все ошибки были исправлены. Остались только рекомендация CIS по включению механизма, обеспечивающего проверку целостности и подлинности образов Docker, используя цифровые подписи.
## Part 6. Базовый Docker Compose
##### Напишем файл docker-compose.yml
Требования к контейнерам:
1) Поднимем докер-контейнер из Части 5.
2) Поднимем докер-контейнер с nginx, который будет проксировать все запросы с 8080 порта на 81 порт первого контейнера.
3) Замапим 8080 порт второго контейнера на 80 порт локальной машины.

![](images/Pasted%20image%2020250225131310.png)\
Файл `docker-compose.yaml` с инструкциями. \
Измененные `nginx.conf` файлы находятся в папке под номером части задания.
#### Соберем и запустим проект
```
docker-compose build
docker-compuse up -d
```
![](images/Pasted%20image%2020250225124041.png)\
Успешная сборка итого проекта.\
![](images/Pasted%20image%2020250225124133.png)\
Успешный запуск проекта.
#### Проверим работу странички
![](images/Pasted%20image%2020250225124215.png)\
localhost:80 выдает необходимую строчку. 